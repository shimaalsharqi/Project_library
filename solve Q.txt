-1)Display all book records.
select * from books
--2)Display each book’s title, genre, and availability
SELECT 
    title,
    genre,
    availability_status
FROM books;
--3)Display all member names, email, and membership start date
SELECT full_name,email, MembershipStartDate
FROM members

--4)Display each book’s title and price as BookPrice.
select title, price as BookPrice
from books

--5)List books priced above 250 LE.(MY DATA IN OMR)
SELECT * from books
where price>25

--6)List members who joined before 2023. 
SELECT * FROM members
WHERE MembershipStartDate < '2023'

--7) Display books published after 2018. 
ALTER TABLE books
ADD published_year INT;

UPDATE books
SET published_year = 2019
WHERE B_ID = 1;

UPDATE books
SET published_year = 2020
WHERE B_ID = 2;

UPDATE books
SET published_year = 2017
WHERE B_ID = 3;

UPDATE books
SET published_year = 2021
WHERE B_ID = 4;

UPDATE books
SET published_year = 2016
WHERE B_ID = 5;

SELECT * FROM books -- to check

SELECT published_year
FROM books
WHERE published_year > 2018

--8)Display books ordered by price descending. 
select * from books
order by price desc

--9)Display the maximum, minimum, and average book price. 
SELECT 
    MAX(price) AS Max_Price,
    MIN(price) AS Min_Price,
    AVG(price) AS Avg_Price
FROM books

--10) Display total number of books. 
SELECT COUNT(*) AS Total_Books
FROM books
--11) Display members with NULL email. 
SELECT * FROM members
WHERE email IS NULL
--12) Display books whose title contains 'Data'
SELECT * FROM books
WHERE title LIKE '%Data%'

--13) Insert yourself as a member (Member ID = 405
SET IDENTITY_INSERT members ON
INSERT INTO members (M_ID, full_name, email, phone_number, MembershipStartDate)
VALUES (405, 'Shima AlSharqi', 'sh@example.com', '90011223', '2025-12-17')

SET IDENTITY_INSERT members OFF
--14)Register yourself to borrow book ID 1011. 
set identity_insert books on
INSERT INTO books (B_ID, Book_ISBN, title, shelf_location, availability_status, price, genre, L_ID)
VALUES (1011, '978-01011', 'Advanced Databases', 'E5', 1, 45.00, 'Reference', 1)

SET IDENTITY_INSERT books OFF

--15)Insert another member with NULL email and phone. 
ALTER TABLE members
ALTER COLUMN  email varchar(50) NULL

ALTER TABLE members
ALTER COLUMN phone_number VARCHAR(20) NULL

INSERT INTO members (full_name, email, phone_number, MembershipStartDate)
VALUES ('New Member', NULL, NULL, GETDATE())

--16) Update the return date of your loan to today.
UPDATE loan
SET return_date = GETDATE(),
    status = 'Returned' 
WHERE M_ID = 405 AND B_ID = 1011

SELECT * FROM loan
WHERE M_ID = 405 AND B_ID = 1011
--17)Increase book prices by 5% for books priced under 200
UPDATE books
SET price = price * 1.05
WHERE price < 200

SELECT title, price
FROM books
WHERE price < 200
--18) Update member status to 'Active' for recently joined members
ALTER TABLE members
ADD status VARCHAR(20) DEFAULT 'Inactive'

UPDATE members
SET status = 'Active'
WHERE MembershipStartDate >= '2025-01-01'

SELECT full_name, MembershipStartDate, status
FROM members
--19) Delete members who never borrowed a book.
DELETE FROM members
WHERE NOT EXISTS (
    SELECT 1 
    FROM loan
    WHERE loan.M_ID = members.M_ID
)

SELECT * FROM members
